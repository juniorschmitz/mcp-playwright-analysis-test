# üîç An√°lise Completa da API ServeRest

## üìñ Informa√ß√µes Gerais

### Vis√£o Geral
A **ServeRest** √© uma API REST gratuita que simula uma loja virtual, desenvolvida para fins educacionais e de testes. Disponibilizada em https://compassuol.serverest.dev/, oferece endpoints completos para gerenciamento de usu√°rios, produtos e carrinho de compras.

### Especifica√ß√µes T√©cnicas
- **Vers√£o da API**: 2.29.7
- **Especifica√ß√£o**: OpenAPI 3.0.0
- **URL Base**: `https://compassuol.serverest.dev`
- **Formato de Dados**: JSON
- **Autentica√ß√£o**: JWT Bearer Token
- **Dura√ß√£o do Token**: 600 segundos (10 minutos)

### Prop√≥sito
Esta API foi criada para ser utilizada em:
- Treinamentos de automa√ß√£o de testes
- Estudos de APIs REST
- Pr√°tica de integra√ß√£o de sistemas
- Desenvolvimento de habilidades em QA

---

## üèóÔ∏è Arquitetura da API

### Modelo de Dados

#### Usu√°rio (User)
```json
{
  "_id": "string",
  "nome": "string",
  "email": "string",
  "password": "string",
  "administrador": "string" // "true" ou "false"
}
```

#### Produto (Product)
```json
{
  "_id": "string",
  "nome": "string",
  "preco": "number",
  "descricao": "string",
  "quantidade": "number"
}
```

#### Carrinho (Cart)
```json
{
  "_id": "string",
  "produtos": [
    {
      "idProduto": "string",
      "quantidade": "number",
      "precoUnitario": "number"
    }
  ],
  "precoTotal": "number",
  "quantidadeTotal": "number",
  "idUsuario": "string"
}
```

#### Token de Autentica√ß√£o
```json
{
  "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### Relacionamentos
- **Usu√°rio ‚Üî Carrinho**: 1:1 (um usu√°rio pode ter apenas um carrinho)
- **Produto ‚Üî Carrinho**: N:M (produtos podem estar em m√∫ltiplos carrinhos)
- **Usu√°rio ‚Üî Produto**: Administradores podem gerenciar produtos

---

## üîó Endpoints Detalhados

### 1. üîë Autentica√ß√£o

#### POST /login
**Descri√ß√£o**: Realiza autentica√ß√£o de usu√°rio e retorna token JWT

**Request Body**:
```json
{
  "email": "string",
  "password": "string"
}
```

**Responses**:
- **200 OK**: Login realizado com sucesso
  ```json
  {
    "message": "Login realizado com sucesso",
    "authorization": "Bearer {token}"
  }
  ```
- **401 Unauthorized**: Credenciais inv√°lidas
  ```json
  {
    "message": "Email e/ou senha inv√°lidos"
  }
  ```

**Valida√ß√µes**:
- Email deve ter formato v√°lido
- Senha √© obrigat√≥ria
- Usu√°rio deve existir no sistema

**Regras de Neg√≥cio**:
- Token JWT expira em 600 segundos
- Token deve ser inclu√≠do no header `Authorization` para endpoints protegidos

---

### 2. üë• Usu√°rios

#### GET /usuarios
**Descri√ß√£o**: Lista todos os usu√°rios cadastrados

**Query Parameters**:
- `_id`: Filtrar por ID espec√≠fico
- `nome`: Filtrar por nome
- `email`: Filtrar por email
- `administrador`: Filtrar por tipo (true/false)

**Response (200 OK)**:
```json
{
  "usuarios": [
    {
      "_id": "BeeJh5lz3k6kSIzA",
      "nome": "Fulano da Silva",
      "email": "fulano@qa.com",
      "password": "teste",
      "administrador": "true"
    }
  ],
  "quantidade": 1
}
```

#### GET /usuarios/{_id}
**Descri√ß√£o**: Busca usu√°rio espec√≠fico por ID

**Path Parameters**:
- `_id`: ID do usu√°rio

**Responses**:
- **200 OK**: Usu√°rio encontrado
- **400 Bad Request**: Usu√°rio n√£o encontrado

#### POST /usuarios
**Descri√ß√£o**: Cadastra novo usu√°rio

**Request Body**:
```json
{
  "nome": "string",
  "email": "string",
  "password": "string",
  "administrador": "string"
}
```

**Valida√ß√µes**:
- Nome √© obrigat√≥rio
- Email deve ser √∫nico e ter formato v√°lido
- Password √© obrigat√≥ria
- Administrador deve ser "true" ou "false"

**Responses**:
- **201 Created**: Usu√°rio criado
- **400 Bad Request**: Dados inv√°lidos ou email j√° existe

#### PUT /usuarios/{_id}
**Descri√ß√£o**: Edita usu√°rio existente ou cria novo se ID n√£o existir

**Autentica√ß√£o**: Requerida

**Request Body**: Mesmo formato do POST

**Responses**:
- **200 OK**: Usu√°rio editado
- **201 Created**: Novo usu√°rio criado
- **401 Unauthorized**: Token inv√°lido

#### DELETE /usuarios/{_id}
**Descri√ß√£o**: Remove usu√°rio do sistema

**Autentica√ß√£o**: Requerida

**Regras de Neg√≥cio**:
- N√£o √© poss√≠vel excluir usu√°rio que possui carrinho

**Responses**:
- **200 OK**: Usu√°rio exclu√≠do
- **400 Bad Request**: Usu√°rio tem carrinho cadastrado
- **401 Unauthorized**: Token inv√°lido

---

### 3. üì¶ Produtos

#### GET /produtos
**Descri√ß√£o**: Lista todos os produtos dispon√≠veis

**Query Parameters**:
- `_id`: Filtrar por ID
- `nome`: Filtrar por nome
- `preco`: Filtrar por pre√ßo
- `descricao`: Filtrar por descri√ß√£o

**Response (200 OK)**:
```json
{
  "produtos": [
    {
      "_id": "BeeJh5lz3k6kSIzA",
      "nome": "Logitech MX Vertical",
      "preco": 470,
      "descricao": "Mouse",
      "quantidade": 382
    }
  ],
  "quantidade": 1
}
```

#### GET /produtos/{_id}
**Descri√ß√£o**: Busca produto espec√≠fico por ID

**Responses**:
- **200 OK**: Produto encontrado
- **400 Bad Request**: Produto n√£o encontrado

#### POST /produtos
**Descri√ß√£o**: Cadastra novo produto

**Autentica√ß√£o**: Requerida (apenas administradores)

**Request Body**:
```json
{
  "nome": "string",
  "preco": "number",
  "descricao": "string",
  "quantidade": "number"
}
```

**Valida√ß√µes**:
- Nome deve ser √∫nico
- Pre√ßo deve ser maior que 0
- Quantidade deve ser maior ou igual a 0

**Responses**:
- **201 Created**: Produto cadastrado
- **400 Bad Request**: Dados inv√°lidos ou nome j√° existe
- **401 Unauthorized**: Token inv√°lido
- **403 Forbidden**: Usu√°rio n√£o √© administrador

#### PUT /produtos/{_id}
**Descri√ß√£o**: Edita produto existente ou cria novo

**Autentica√ß√£o**: Requerida (apenas administradores)

**Responses**:
- **200 OK**: Produto editado
- **201 Created**: Novo produto criado
- **401 Unauthorized**: Token inv√°lido
- **403 Forbidden**: Usu√°rio n√£o √© administrador

#### DELETE /produtos/{_id}
**Descri√ß√£o**: Remove produto do sistema

**Autentica√ß√£o**: Requerida (apenas administradores)

**Regras de Neg√≥cio**:
- N√£o √© poss√≠vel excluir produto que est√° em carrinho

**Responses**:
- **200 OK**: Produto exclu√≠do
- **400 Bad Request**: Produto faz parte de carrinho
- **401 Unauthorized**: Token inv√°lido
- **403 Forbidden**: Usu√°rio n√£o √© administrador

---

### 4. üõí Carrinhos

#### GET /carrinhos
**Descri√ß√£o**: Lista todos os carrinhos ativos

**Query Parameters**:
- `_id`: Filtrar por ID
- `idUsuario`: Filtrar por usu√°rio
- `precoTotal`: Filtrar por pre√ßo total

**Response (200 OK)**:
```json
{
  "carrinhos": [
    {
      "_id": "qbMqntef4iTOwWfg",
      "produtos": [
        {
          "idProduto": "BeeJh5lz3k6kSIzA",
          "quantidade": 2,
          "precoUnitario": 470
        }
      ],
      "precoTotal": 940,
      "quantidadeTotal": 2,
      "idUsuario": "0uxuPY0cbmQhpEz1"
    }
  ],
  "quantidade": 1
}
```

#### GET /carrinhos/{_id}
**Descri√ß√£o**: Busca carrinho espec√≠fico por ID

**Responses**:
- **200 OK**: Carrinho encontrado
- **400 Bad Request**: Carrinho n√£o encontrado

#### POST /carrinhos
**Descri√ß√£o**: Cadastra novo carrinho para usu√°rio autenticado

**Autentica√ß√£o**: Requerida

**Request Body**:
```json
{
  "produtos": [
    {
      "idProduto": "string",
      "quantidade": "number"
    }
  ]
}
```

**Regras de Neg√≥cio**:
- Usu√°rio pode ter apenas um carrinho
- Produto deve existir
- Quantidade solicitada deve estar dispon√≠vel em estoque
- Estoque √© reduzido automaticamente

**Responses**:
- **201 Created**: Carrinho cadastrado
- **400 Bad Request**: Regras de neg√≥cio violadas
- **401 Unauthorized**: Token inv√°lido

#### PUT /carrinhos/{_id}
**Descri√ß√£o**: Edita carrinho existente

**Autentica√ß√£o**: Requerida

**Comportamento**:
- Se carrinho n√£o existir, cria novo
- Atualiza produtos e quantidades
- Recalcula pre√ßos automaticamente

#### DELETE /carrinhos/concluir-compra
**Descri√ß√£o**: Finaliza compra e remove carrinho

**Autentica√ß√£o**: Requerida

**Comportamento**:
- Remove carrinho do usu√°rio autenticado
- Mant√©m produtos com estoque reduzido
- Simula conclus√£o da compra

**Responses**:
- **200 OK**: Compra conclu√≠da
- **401 Unauthorized**: Token inv√°lido

#### DELETE /carrinhos/cancelar-compra
**Descri√ß√£o**: Cancela compra e restaura estoque

**Autentica√ß√£o**: Requerida

**Comportamento**:
- Remove carrinho do usu√°rio autenticado
- Restaura quantidade dos produtos ao estoque
- Simula cancelamento da compra

**Responses**:
- **200 OK**: Compra cancelada
- **401 Unauthorized**: Token inv√°lido

---

## üîí Sistema de Autentica√ß√£o

### JWT Token
A API utiliza JSON Web Tokens (JWT) para autentica√ß√£o:

**Caracter√≠sticas**:
- **Algoritmo**: HS256
- **Dura√ß√£o**: 600 segundos (10 minutos)
- **Header**: `Authorization: Bearer {token}`

**Estrutura do Token**:
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJlbWFpbCI6ImZ1bGFub0BxYS5jb20iLCJwYXNzd29yZCI6InRlc3RlIiwiaWF0IjoxNjc5MzQyNjUwLCJleHAiOjE2NzkzNDMyNTB9.
rSsXDB_bSdkJvnF0vI5qP4ZgNzKzV8mHzU9Y7nGxUxA
```

### N√≠veis de Acesso

#### Usu√°rio Comum
- Pode gerenciar pr√≥prio perfil
- Pode visualizar produtos
- Pode gerenciar pr√≥prio carrinho
- **N√£o pode** criar/editar/deletar produtos

#### Administrador
- Todas as permiss√µes de usu√°rio comum
- Pode criar, editar e deletar produtos
- Acesso completo √† gest√£o do cat√°logo

### Endpoints Protegidos
- `PUT /usuarios/{_id}` - Requer autentica√ß√£o
- `DELETE /usuarios/{_id}` - Requer autentica√ß√£o
- `POST /produtos` - Requer admin
- `PUT /produtos/{_id}` - Requer admin
- `DELETE /produtos/{_id}` - Requer admin
- `POST /carrinhos` - Requer autentica√ß√£o
- `PUT /carrinhos/{_id}` - Requer autentica√ß√£o
- `DELETE /carrinhos/*` - Requer autentica√ß√£o

---

## üìä Regras de Neg√≥cio

### Usu√°rios
1. **Email √∫nico**: Cada email pode estar associado a apenas um usu√°rio
2. **Administrador √∫nico**: O sistema permite m√∫ltiplos administradores
3. **Carrinho obrigat√≥rio**: Usu√°rios com carrinho n√£o podem ser exclu√≠dos

### Produtos
1. **Nome √∫nico**: Cada produto deve ter nome exclusivo
2. **Estoque controlado**: Quantidade n√£o pode ser negativa
3. **Carrinho protege**: Produtos em carrinho n√£o podem ser exclu√≠dos
4. **Admin exclusivo**: Apenas administradores gerenciam produtos

### Carrinhos
1. **Um por usu√°rio**: Cada usu√°rio pode ter apenas um carrinho ativo
2. **Estoque autom√°tico**: Produtos s√£o reservados automaticamente
3. **Valida√ß√£o de estoque**: N√£o permite adicionar mais que dispon√≠vel
4. **Cancelamento restaura**: Cancelar compra devolve produtos ao estoque

### Autentica√ß√£o
1. **Token expira**: JWT tem dura√ß√£o limitada de 600 segundos
2. **Bearer obrigat√≥rio**: Token deve ser enviado no header Authorization
3. **Valida√ß√£o cont√≠nua**: Cada requisi√ß√£o valida o token

---

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

### Limita√ß√µes T√©cnicas
- **Persist√™ncia**: Dados s√£o armazenados em mem√≥ria (reset peri√≥dico)
- **Rate Limiting**: N√£o implementado
- **CORS**: Configurado para permitir todas as origens
- **HTTPS**: Dispon√≠vel apenas em HTTPS

### Considera√ß√µes de Teste
- **Dados de teste**: Alguns usu√°rios e produtos est√£o pr√©-cadastrados
- **Reset autom√°tico**: Base de dados √© reiniciada periodicamente
- **Concorr√™ncia**: M√∫ltiplos usu√°rios podem afetar dados compartilhados

### Comportamentos Espec√≠ficos
- **IDs √∫nicos**: Sistema gera IDs autom√°ticos para novos registros
- **Validation Messages**: Mensagens de erro em portugu√™s
- **Case Sensitive**: Emails s√£o case-sensitive
- **Numeric Types**: Pre√ßos e quantidades s√£o tratados como n√∫meros

---

## üß™ Estrat√©gia de Testes

### Testes Funcionais
1. **CRUD Completo**: Testar todas as opera√ß√µes para cada endpoint
2. **Valida√ß√µes**: Verificar todas as valida√ß√µes de entrada
3. **Regras de Neg√≥cio**: Validar cumprimento das regras estabelecidas
4. **Estados**: Testar diferentes estados da aplica√ß√£o

### Testes de Seguran√ßa
1. **Autentica√ß√£o**: Validar controle de acesso
2. **Autoriza√ß√£o**: Verificar permiss√µes por n√≠vel de usu√°rio
3. **Input Validation**: Testar sanitiza√ß√£o de entradas
4. **Token Management**: Verificar ciclo de vida dos tokens

### Testes de Integra√ß√£o
1. **Fluxos E2E**: Jornadas completas de usu√°rio
2. **Consist√™ncia**: Integridade entre opera√ß√µes relacionadas
3. **Estado Compartilhado**: Impacto de opera√ß√µes concorrentes

### Testes de Performance
1. **Response Time**: Tempo de resposta de cada endpoint
2. **Throughput**: Capacidade de processamento
3. **Load Testing**: Comportamento sob carga
4. **Stress Testing**: Identifica√ß√£o de limites

---

## üìà M√©tricas de Qualidade

### Disponibilidade
- **Uptime**: > 99%
- **Response Time**: < 2 segundos (P95)
- **Error Rate**: < 1%

### Funcionalidade
- **Coverage**: 100% dos endpoints
- **Business Rules**: 100% das regras implementadas
- **Validation**: 100% das valida√ß√µes testadas

### Seguran√ßa
- **Authentication**: 100% dos endpoints protegidos validados
- **Authorization**: 100% dos n√≠veis de acesso testados
- **Input Validation**: 100% das entradas sanitizadas

---

## üîß Ferramentas Recomendadas

### Automa√ß√£o de Testes
- **Postman/Newman**: Collections automatizadas
- **REST Assured**: Testes em Java
- **Cypress**: Testes E2E com UI
- **K6**: Testes de performance

### Monitoramento
- **Datadog**: APM e m√©tricas
- **New Relic**: Performance monitoring
- **Pingdom**: Uptime monitoring

### CI/CD
- **GitHub Actions**: Pipeline automatizado
- **Jenkins**: Integra√ß√£o cont√≠nua
- **Docker**: Containeriza√ß√£o de testes

---

## üìö Recursos Adicionais

### Documenta√ß√£o
- **Swagger UI**: https://compassuol.serverest.dev/
- **Repository**: https://github.com/ServeRest/ServeRest
- **NPM Package**: https://www.npmjs.com/package/serverest

### Comunidade
- **Issues**: Reportar problemas no GitHub
- **Discussions**: D√∫vidas e melhorias
- **Contributing**: Contribui√ß√µes s√£o bem-vindas

### Exemplos
- **Postman Collections**: Exemplos na documenta√ß√£o
- **Code Samples**: Diferentes linguagens dispon√≠veis
- **Tutorials**: Guias passo a passo

---

*An√°lise realizada em 19 de Agosto de 2025 - ServeRest API v2.29.7*